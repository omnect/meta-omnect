From 0be50f71d8f47adb459aed95df29d32e8f7a9030 Mon Sep 17 00:00:00 2001
From: SteffenRumler <steffen.rumler@conplement.de>
Date: Wed, 30 Mar 2022 15:26:25 +0200
Subject: [PATCH] Add u-boot command rstinfo used to check for power-on reset

---
 arch/arm/mach-bcm283x/Makefile | 1 +
 cmd/Kconfig                    | 7 +++++++
 cmd/Makefile                   | 1 +
 3 files changed, 9 insertions(+)

diff --git a/arch/arm/mach-bcm283x/Makefile b/arch/arm/mach-bcm283x/Makefile
index 7cd068832f..e92bfe9616 100644
--- a/arch/arm/mach-bcm283x/Makefile
+++ b/arch/arm/mach-bcm283x/Makefile
@@ -4,3 +4,4 @@
 
 obj-$(CONFIG_BCM2835) += lowlevel_init.o
 obj-y	+= init.o reset.o mbox.o msg.o phys2bus.o
+obj-$(CONFIG_DISPLAY_CPUINFO) += sys_info.o
diff --git a/cmd/Kconfig b/cmd/Kconfig
index 02c298fdbe..d3b579008f 100644
--- a/cmd/Kconfig
+++ b/cmd/Kconfig
@@ -157,6 +157,13 @@ config CMD_REGINFO
 	help
 	  Register dump
 
+config CMD_RSTINFO
+	bool "rstinfo"
+	depends on BCM2711
+	default n
+	help
+	  Detect the restart cause. Set the (non-persistent) environment variable rstinfo accordingly.
+
 config CMD_TLV_EEPROM
 	bool "tlv_eeprom"
 	depends on I2C_EEPROM
diff --git a/cmd/Makefile b/cmd/Makefile
index e31ac15ef7..1402cc2d89 100644
--- a/cmd/Makefile
+++ b/cmd/Makefile
@@ -133,6 +133,7 @@ obj-$(CONFIG_CMD_REMOTEPROC) += remoteproc.o
 obj-$(CONFIG_CMD_RNG) += rng.o
 obj-$(CONFIG_CMD_KASLRSEED) += kaslrseed.o
 obj-$(CONFIG_CMD_ROCKUSB) += rockusb.o
+obj-$(CONFIG_CMD_RSTINFO) += rstinfo.o
 obj-$(CONFIG_CMD_RTC) += rtc.o
 obj-$(CONFIG_SANDBOX) += host.o
 obj-$(CONFIG_CMD_SATA) += sata.o
